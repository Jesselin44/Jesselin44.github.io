<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Trivia Quiz </title>

    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
        rel="stylesheet"
    >
</head>
<body class="bg-success">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="index.html">Trivia FUN</a>
        <div class="navbar-nav">
            <a class="nav-link active" href="index.html">Home</a>
            <a class="nav-link" href="docs.html">Docs</a>
        </div>
    </div>
</nav>

<div class="container mt-4 mb-5">
    <div class="row">
        <div class="col-md-8 mx-auto">

            <div class="card bg-success-subtle">
                <div class="card-body">
                    <h1 class="h3 mb-3 text-center">Are YOU Ready For Some Trivia üßê?!?!?</h1>
                    <p class="text-muted">
                        Choose Your Topic Below !!!!!! 
                    
                    </p>

                    <!--Error message -->
                    <div id="errorBox" class="alert alert-danger d-none" role="alert">
                    
                    </div>

                    <!--Quiz setup form -->
                    <form>
                        
                        <div class="mb-3">
                            <label for="categorySelect" class="form-label">Category</label>
                            <select id="categorySelect" class="form-select">
                                <option value="">Loading categories...</option>
                            </select>
                        </div>

                        
                        <div class="mb-3">
                            <label for="difficultySelect" class="form-label">Difficulty</label>
                            <select id="difficultySelect" class="form-select">
                                <option value="">Any Difficulty</option>
                                <option value="easy">Easy Peasy Lemon Squeezy üòá</option>
                                <option value="medium">Tricky ü§®</option>
                                <option value="hard">Troublesome ü§î</option>
                            </select>
                        </div>

                        
                        <div class="mb-3">
                            <label for="amountInput" class="form-label">Number of Questions</label>
                            <input 
                                type="number" 
                                id="amountInput" 
                                class="form-control" 
                                value="5" 
                                min="1" 
                                max="20"
                            >
                        </div>

                        <div class="d-grid">
                            <button 
                                type="button" 
                                class="btn btn-success w-100 text-white"
                                onclick="startQuiz()"
                            >
                               üî• Begin Quiz üî•
                            </button>
                        </div>
                    </form>

                    <hr class="my-4">

                    <p class="small text-muted">
                        
                    Lets Have Some Fun !!!!!
                    </p>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


<script>

function decodeHTML(text) {
    var tempElement = document.createElement("textarea");
    tempElement.innerHTML = text;
    return tempElement.value;
}


function loadCategories() {
    var categorySelect = document.getElementById("categorySelect");
    var errorBox = document.getElementById("errorBox");

    fetch("https://opentdb.com/api_category.php")
        .then(function(response) {
            return response.json();
        })
        .then(function(data) {
            //Clearing of existing options
            categorySelect.innerHTML = "";

            //Add an "Any Category" option
            var anyOption = document.createElement("option");
            anyOption.value = "";
            anyOption.textContent = "Any Category";
            categorySelect.appendChild(anyOption);

            //Loop through categories from the API
            var categories = data.trivia_categories;
            for (var i = 0; i < categories.length; i++) {
                var option = document.createElement("option");
                option.value = categories[i].id;
                option.textContent = categories[i].name;
                categorySelect.appendChild(option);
            }
        })
        .catch(function(error) {
            // displays an error message
            errorBox.textContent = "Could not load categories. Please check your internet connection and refresh the page.";
            errorBox.classList.remove("d-none");
        });
}

// Called when the user starts the quiz
function startQuiz() {
    var categorySelect = document.getElementById("categorySelect");
    var difficultySelect = document.getElementById("difficultySelect");
    var amountInput = document.getElementById("amountInput");
    var errorBox = document.getElementById("errorBox");

    //hides previous errors
    errorBox.classList.add("d-none");
    errorBox.textContent = "";

    var category = categorySelect.value;
    var difficulty = difficultySelect.value;
    var amount = amountInput.value;

    if (amount === "" || Number(amount) <= 0) {
        errorBox.textContent = "Please choose a valid number of questions.";
        errorBox.classList.remove("d-none");
        return;
    }

    //Builds a query string to pass options to quiz.html
    var query = "?amount=" + encodeURIComponent(amount);

    if (category !== "") {
        query += "&category=" + encodeURIComponent(category);
    }
    if (difficulty !== "") {
        query += "&difficulty=" + encodeURIComponent(difficulty);
    }

    //Goes to quiz.html with the selected options in the URL
    window.location.href = "quiz.html" + query;
}

//Run loadCategories() when the page is loaded
window.onload = function() {
    loadCategories();
};
</script>

</body>
</html>
